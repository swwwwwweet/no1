<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>

<meta name="viewport" 
      content="width=device-width,
               initial-scale=1.0,
               minimum-scale=1.0,
               maximum-scale=5.0,
               user-scalable=yes"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="theme-color" content="#A4E0B8"/>
<link rel="manifest" href="manifest.json"/>
<link rel="apple-touch-icon" sizes="192x192" href="icon-192.png"/>
<link rel="apple-touch-icon" sizes="512x512" href="icon-512.png"/>
<title>å¸Œçš„ä¸€å¤© - æŠ½å¡ä»»åŠ¡ç®¡ç†</title>
<style>
body{margin:0;padding:0;background-color:#F3F3FF;font-family:sans-serif}

.scrollableHack {
  min-width: 1200px; 
  min-height: 2000px;
}
.container{max-width:400px;margin:0 auto;padding:10px}
#resultContainer{background-color:#03755E;min-height:50px;padding:10px;border-radius:5px}
.resultItem{background-color:#E4F4B0;margin:5px 0;padding:8px;border-radius:3px;display:flex;justify-content:space-between;align-items:center}
.resultText{flex:1}
.completeBtn{background-color:#A4E0B8;border:none;border-radius:3px;padding:3px 6px;cursor:pointer}
.buttonRow{display:flex;flex-direction:column;gap:10px;margin-top:10px}
.buttonRow button{width:100%;background-color:#A4E0B8;border:none;padding:12px;border-radius:5px;font-size:16px;cursor:pointer}
#editToggle,#viewToggle{margin-top:10px;width:100%;background-color:#A4E0B8;border:none;padding:10px;border-radius:5px;font-size:16px;cursor:pointer}
#editArea,#viewArea{margin-top:10px}
#editArea{background-color:#F3F3FF;padding:10px 5px;border-radius:5px}
#editArea input[type="text"]{width:100%;padding:8px;margin:5px 0;border:1px solid #ccc;border-radius:3px;font-size:14px}
#editArea #saveContent{background-color:#A4E0B8;border:none;border-radius:5px;padding:8px;margin-right:5px;cursor:pointer;font-size:14px}
#editArea label{display:inline-block;margin-right:10px;margin-top:6px;font-size:14px}
#viewArea{background-color:#E4F4B0;padding:10px;border-radius:5px}
#viewArea h4{margin:5px 0;font-size:16px}
#viewArea ul{list-style:none;padding-left:0;margin:0}
#viewArea li{margin:3px 0;display:flex;justify-content:space-between;align-items:center;font-size:14px}
#viewArea li span{flex:1}
.deleteBtn{background-color:#ccc;border:none;border-radius:3px;padding:3px 6px;cursor:pointer}
#chartSection{display:none;margin-top:20px;text-align:center}
#chartSection canvas{display:block;margin:0 auto 20px auto}
.chart-controls{display:flex;flex-direction:column;gap:10px;justify-content:center;margin-bottom:10px}
.chart-controls button{padding:8px 12px;font-size:14px;border:none;border-radius:5px;background:#A4E0B8;cursor:pointer}
#detailsSection{display:none;padding:10px;border:1px solid #ccc;border-radius:5px;background:#f9f9f9;text-align:left;font-size:14px}
#detailsSection ul{list-style:none;margin:0 0 10px 0;padding-left:0}
#detailsSection li{margin-bottom:5px}
#detailsSection p{margin:0;font-weight:bold}
#startTimerBtn{width:100%;background-color:#A4E0B8;border:none;padding:12px;border-radius:5px;font-size:16px;cursor:pointer;margin-top:10px}
#bottomImg{display:block;width:100%;height:auto;margin-top:20px}
</style>
</head>
<body>
<!-- ç”¨scrollableHackåŒ…è£¹åŸæœ‰.containerï¼Œä»¥åˆ¶é€ è¶³å¤Ÿå®½é«˜ -->
<div class="scrollableHack">
  <div class="container">
    <div id="resultContainer"></div>
    <div class="buttonRow">
      <button id="drawOne">æŠ½å–ä¸€æ¬¡ğŸ¾</button>
      <button id="drawTen">æŠ½å–åæ¬¡ğŸ¾</button>
    </div>
    <button id="editToggle">ç¼–è¾‘å†…å®¹</button>
    <div id="editArea" style="display:none;">
      <button id="saveContent">ä¿å­˜</button>
      <input type="text" id="taskInput" placeholder="è¯·è¾“å…¥ä»»åŠ¡å†…å®¹"/>
      <br>
      <label><input type="radio" name="catSelect" id="studyRadio" value="study"> å­¦ä¹ å·¥ä½œ</label>
      <label><input type="radio" name="catSelect" id="homeRadio" value="home"> å®¶åŠ¡è¿åŠ¨</label>
    </div>
    <button id="viewToggle">æŸ¥çœ‹å†…å®¹</button>
    <div id="viewArea" style="display:none;">
      <h4>å­¦ä¹ æˆ–å·¥ä½œé¡¹ç›®ç±»</h4>
      <ul id="listStudy"></ul>
      <h4>å®¶åŠ¡æˆ–è¿åŠ¨é¡¹ç›®ç±»</h4>
      <ul id="listHome"></ul>
    </div>
    <button id="startTimerBtn" disabled>å¼€å§‹è®¡æ—¶</button>
    <section id="chartSection">
      <canvas id="pieChart" width="300" height="300"></canvas>
      <div class="chart-controls">
        <button id="clearData">æ¸…ç©ºåœ†é¥¼æ•°æ®</button>
        <button id="toggleDetails">æŸ¥çœ‹è¯¦æƒ…</button>
      </div>
      <div id="detailsSection"></div>
    </section>
    <img id="bottomImg" src="512x512-1.png"/>
  </div>
</div>
<script>
let tasksStudy=[],tasksHome=[]
if(localStorage.getItem("tasksStudy")){tasksStudy=JSON.parse(localStorage.getItem("tasksStudy"))}
if(localStorage.getItem("tasksHome")){tasksHome=JSON.parse(localStorage.getItem("tasksHome"))}
const resultContainer=document.getElementById("resultContainer"),
      drawOneBtn=document.getElementById("drawOne"),
      drawTenBtn=document.getElementById("drawTen"),
      editToggleBtn=document.getElementById("editToggle"),
      editArea=document.getElementById("editArea"),
      saveContentBtn=document.getElementById("saveContent"),
      taskInput=document.getElementById("taskInput"),
      studyRadio=document.getElementById("studyRadio"),
      homeRadio=document.getElementById("homeRadio"),
      viewToggleBtn=document.getElementById("viewToggle"),
      viewArea=document.getElementById("viewArea"),
      listStudy=document.getElementById("listStudy"),
      listHome=document.getElementById("listHome"),
      startTimerBtn=document.getElementById("startTimerBtn"),
      bottomImg=document.getElementById("bottomImg")

const entertainmentList=[
  "äººï¼Œå¯ä»¥åˆ·äºŒååˆ†é’Ÿè§†é¢‘",
  "åƒç‚¹é›¶é£Ÿæ€ä¹ˆæ ·ï¼Ÿæ¨èå†°å¯ä¹",
  "æˆ–è®¸æ˜¯æ—¶å€™å¥–åŠ±è‡ªå·±æ‰“ä¸€æŠŠæ¸¸æˆäº†ï¼Œè®°å¾—åŠ³é€¸ç»“åˆ"
],
relaxationList=[
  "å¥–åŠ±è‡ªå·±åƒä¸€é¡¿å¤§é¤æ˜¯ä¸é”™çš„é€‰æ‹©",
  "ä»Šå¤©å‰©ä¸‹çš„æ—¶é—´ç”¨ä½œä¼‘æ¯å¥½äº†ï¼Œä½ å·²ç»å¾ˆåŠªåŠ›äº†"
]

editToggleBtn.addEventListener("click",()=>{
  if(editArea.style.display==="none"){
    editArea.style.display="block"
    viewArea.style.display="none"
  } else {
    editArea.style.display="none"
  }
})

viewToggleBtn.addEventListener("click",()=>{
  if(viewArea.style.display==="none"){
    buildContentList()
    viewArea.style.display="block"
    editArea.style.display="none"
  } else {
    viewArea.style.display="none"
  }
})

saveContentBtn.addEventListener("click",()=>{
  const text=taskInput.value.trim(),
        isStudy=studyRadio.checked,
        isHome=homeRadio.checked
  if(!text){
    alert("è¯·è¾“å…¥è¦ä¿å­˜çš„ä»»åŠ¡å†…å®¹")
    return
  }
  if(!isStudy&&!isHome){
    alert("è¯·é€‰æ‹©ä»»åŠ¡ç±»åˆ«ï¼ˆå­¦ä¹ å·¥ä½œæˆ–å®¶åŠ¡è¿åŠ¨ï¼‰")
    return
  }
  if(isStudy){
    tasksStudy.push(text)
    localStorage.setItem("tasksStudy",JSON.stringify(tasksStudy))
  } else if(isHome){
    tasksHome.push(text)
    localStorage.setItem("tasksHome",JSON.stringify(tasksHome))
  }
  taskInput.value=""
  studyRadio.checked=false
  homeRadio.checked=false
})

function buildContentList(){
  listStudy.innerHTML=""
  listHome.innerHTML=""
  tasksStudy.forEach((item,idx)=>{
    const li=document.createElement("li"),
          span=document.createElement("span")
    span.textContent=item
    const delBtn=document.createElement("button")
    delBtn.textContent="åˆ é™¤"
    delBtn.className="deleteBtn"
    delBtn.addEventListener("click",()=>{
      tasksStudy.splice(idx,1)
      localStorage.setItem("tasksStudy",JSON.stringify(tasksStudy))
      buildContentList()
    })
    li.appendChild(span)
    li.appendChild(delBtn)
    listStudy.appendChild(li)
  })
  tasksHome.forEach((item,idx)=>{
    const li=document.createElement("li"),
          span=document.createElement("span")
    span.textContent=item
    const delBtn=document.createElement("button")
    delBtn.textContent="åˆ é™¤"
    delBtn.className="deleteBtn"
    delBtn.addEventListener("click",()=>{
      tasksHome.splice(idx,1)
      localStorage.setItem("tasksHome",JSON.stringify(tasksHome))
      buildContentList()
    })
    li.appendChild(span)
    li.appendChild(delBtn)
    listHome.appendChild(li)
  })
}

function getRandomTask(){
  const n=Math.floor(Math.random()*1000)
  let category
  if(n<499){
    category="study"
  } else if(n<666){
    category="entertainment"
  } else if(n<833){
    category="home"
  } else {
    category="relaxation"
  }
  let result=""
  if(category==="study"){
    result=(tasksStudy.length===0)?"æ— ":tasksStudy[Math.floor(Math.random()*tasksStudy.length)]
  } else if(category==="home"){
    result=(tasksHome.length===0)?"æ— ":tasksHome[Math.floor(Math.random()*tasksHome.length)]
  } else if(category==="entertainment"){
    result=entertainmentList[Math.floor(Math.random()*entertainmentList.length)]
  } else {
    result=relaxationList[Math.floor(Math.random()*relaxationList.length)]
  }
  return{text:result,cat:category}
}

let completedRecords=JSON.parse(localStorage.getItem("completedRecords")||"[]"),
    colorMap={
      study:"#03755E",
      home:"#A4E0B8",
      entertainment:"#F3F3FF",
      relaxation:"#E4F4B0"
    },
    lastCompleteTime=0,
    inTiming=false

function updateTimerButtonState(){
  startTimerBtn.disabled=(resultContainer.children.length===0)
}

function drawPieChart(){
  const canvas=document.getElementById("pieChart"),
        ctx=canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width,canvas.height)
  if(completedRecords.length===0)return
  bottomImg.src="512x512-2.png"
  let timeMap={study:0,home:0,entertainment:0,relaxation:0}
  for(let rec of completedRecords){
    timeMap[rec.cat]+=rec.duration
  }
  let totalTime=timeMap.study+timeMap.home+timeMap.entertainment+timeMap.relaxation
  if(totalTime===0)return
  let startAngle=-Math.PI/2
  ;["study","home","entertainment","relaxation"].forEach(cat=>{
    if(timeMap[cat]<=0)return
    const sliceAngle=(timeMap[cat]/totalTime)*2*Math.PI
    ctx.beginPath()
    const cx=canvas.width/2,
          cy=canvas.height/2,
          radius=Math.min(cx,cy)-2
    ctx.moveTo(cx,cy)
    ctx.arc(cx,cy,radius,startAngle,startAngle+sliceAngle)
    ctx.closePath()
    ctx.fillStyle=colorMap[cat]||"#ccc"
    ctx.fill()
    ctx.strokeStyle="#fff"
    ctx.lineWidth=2
    ctx.stroke()
    startAngle+=sliceAngle
  })
}

function updateDetailsSection(){
  const detailsEl=document.getElementById("detailsSection")
  if(completedRecords.length===0){
    detailsEl.innerHTML=""
    return
  }
  let html="<ul>"
  for(let rec of completedRecords){
    html+="<li>"+rec.name+" - "+rec.duration+"ç§’</li>"
  }
  html+="</ul>"
  const totalTasks=completedRecords.length,
        totalTime=completedRecords.reduce((sum,rc)=>sum+rc.duration,0)
  html+="<p>å…±å®Œæˆ "+totalTasks+" ä¸ªä»»åŠ¡ï¼Œæ€»è€—æ—¶ "+totalTime+" ç§’ã€‚</p>"
  detailsEl.innerHTML=html
}

if(completedRecords.length>0){
  document.getElementById("chartSection").style.display="block"
  drawPieChart()
}

function addResultItem(obj){
  const itemDiv=document.createElement("div")
  itemDiv.className="resultItem"
  const span=document.createElement("span")
  span.className="resultText"
  span.textContent=obj.text
  const completeButton=document.createElement("button")
  completeButton.className="completeBtn"
  completeButton.textContent="å®Œæˆ"

  completeButton.addEventListener("click",()=>{
    if(!inTiming){
      alert("è¯·å…ˆç‚¹å‡»å¼€å§‹è®¡æ—¶")
      return
    }
    resultContainer.removeChild(itemDiv)
    const now=Date.now()
    const durationSec=Math.round((now-(lastCompleteTime||now))/1000)
    lastCompleteTime=0
    inTiming=false
    completedRecords.push({name:obj.text,cat:obj.cat,duration:durationSec})
    localStorage.setItem("completedRecords",JSON.stringify(completedRecords))
    if(completedRecords.length===1){
      document.getElementById("chartSection").style.display="block"
    }
    drawPieChart()
    if(document.getElementById("detailsSection").style.display!=="none"){
      updateDetailsSection()
    }
    if(resultContainer.children.length===0){
      drawOneBtn.disabled=false
      drawTenBtn.disabled=false
      bottomImg.src="512x512-1.png"
    }
    updateTimerButtonState()
  })

  itemDiv.appendChild(span)
  itemDiv.appendChild(completeButton)
  resultContainer.appendChild(itemDiv)
  updateTimerButtonState()
}

function drawOne(){
  if(resultContainer.children.length>0){
    alert("å½“å‰æœ‰æœªå®Œæˆä»»åŠ¡ï¼Œè¯·å®Œæˆåå†æŠ½å¡")
    return
  }
  const taskObj=getRandomTask()
  addResultItem(taskObj)
  if(resultContainer.children.length>0){
    drawOneBtn.disabled=true
    drawTenBtn.disabled=true
  }
}

function drawTen(){
  if(resultContainer.children.length>0){
    alert("å½“å‰æœ‰æœªå®Œæˆä»»åŠ¡ï¼Œè¯·å®Œæˆåå†æŠ½å¡")
    return
  }
  for(let i=0;i<10;i++){
    const taskObj=getRandomTask()
    addResultItem(taskObj)
  }
  if(resultContainer.children.length>0){
    drawOneBtn.disabled=true
    drawTenBtn.disabled=true
  }
}

drawOneBtn.addEventListener("click",drawOne)
drawTenBtn.addEventListener("click",drawTen)

document.getElementById("clearData").addEventListener("click",()=>{
  completedRecords=[]
  localStorage.setItem("completedRecords","[]")
  lastCompleteTime=0
  inTiming=false
  document.getElementById("chartSection").style.display="none"
  document.getElementById("detailsSection").style.display="none"
  document.getElementById("toggleDetails").textContent="æŸ¥çœ‹è¯¦æƒ…"
  bottomImg.src="512x512-1.png"
  drawPieChart()
})

document.getElementById("toggleDetails").addEventListener("click",()=>{
  const detailsEl=document.getElementById("detailsSection")
  if(detailsEl.style.display==="none"){
    updateDetailsSection()
    detailsEl.style.display="block"
    document.getElementById("toggleDetails").textContent="æ”¶èµ·è¯¦æƒ…"
  } else {
    detailsEl.style.display="none"
    document.getElementById("toggleDetails").textContent="æŸ¥çœ‹è¯¦æƒ…"
  }
})

startTimerBtn.addEventListener("click",()=>{
  if(inTiming){
    alert("æ­£åœ¨è®¡æ—¶ä¸­")
    return
  }
  if(resultContainer.children.length===0){
    alert("å½“å‰æ— ä»»åŠ¡")
    return
  }
  lastCompleteTime=Date.now()
  inTiming=true
})

updateTimerButtonState()
</script>
<script>
if("serviceWorker"in navigator){
  window.addEventListener("load",()=>{
    navigator.serviceWorker.register("service-worker.js")
  })
}
</script>
</body>
</html>
